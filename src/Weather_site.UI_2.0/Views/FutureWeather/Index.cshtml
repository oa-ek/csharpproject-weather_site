
@model Views_FutureWeather_Index
@{
    ViewBag.Title = "FutureWeather";
}
@using Azure.Core
@using Weather_site.Core.Entities
<!DOCTYPE html>
<html>
<head>
    <title>Прогноз погоди на 3 дні вперед</title>
</head>
<body>
    <h1>Прогноз погоди на 3 дні вперед</h1>

    <form method="get">
        <label for="city">Введіть місто:</label>
        <input type="text" id="city" name="city" required>
        <button type="submit">Отримати прогноз</button>
    </form>

    @if (Context.Request.Query.ContainsKey("city"))
    {
        string city = Context.Request.Query["city"];
        string apiKey = "8113fcc5a7494b0518bd91ef3acc074f";

        string apiUrl = $"https://api.openweathermap.org/data/2.5/forecast?q={city}&appid={apiKey}&units=metric";

        using (var client = new System.Net.Http.HttpClient())
        {
            var response = await client.GetAsync(apiUrl);
            var content = await response.Content.ReadAsStringAsync();

            dynamic data = Newtonsoft.Json.JsonConvert.DeserializeObject(content);

            if (data != null && data.list != null && data.list.Count > 0)
            {
                <h2>Прогноз погоди для міста @data.city.name</h2>

                <table>
                    <tr>
                        <th>Дата</th>
                        <th>Погода</th>
                        <th>Температура, °C</th>
                    </tr>

                    @foreach (var item in data.list)
                    {
                        DateTime date = DateTime.Parse(item.dt_txt);
                        string weatherDescription = item.weather[0].description;
                        double temperature = Convert.ToDouble(item.main.temp);

                        <tr>
                            <td>@date.ToString("dd.MM.yyyy")</td>
                            <td>@weatherDescription</td>
                            <td>@temperature</td>
                        </tr>
                    }
                </table>
            }
            else
            {
                <p>Прогноз погоди недоступний для цього міста.</p>
            }
        }
    }
</body>
</html>